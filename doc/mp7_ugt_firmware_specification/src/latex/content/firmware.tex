\section{Global Trigger System overview}\label{sec:gt_system}

The Global Trigger System is based on uTCA technology and 10Gbps optical links. A set of 6 MP7 boards (see~\cite{MP7}) with FPGAs of the powerful Xilinx Virtex-7 family is available. The Global Trigger firmware is implemented on these FPGAs. Every FPGA contains a part of the VHDL representation of a L1 Menu, the partitioning is done by VHDL Producer tool. The trigger decision of every MP7 board is collected on an AMC502 board to generate the "final OR" signal which triggers the readout of the detector.

\section{Firmware overview}\label{sec:fw}
The figure \ref{fig:mgt} shows the architecture of \ugt payload. It consists of framework and the algorithm logic which it consists of the following modules:
\begin{enumerate}
\item Global Trigger Logic Data Mapping
\item \ugtl
\item \ufdl
\end{enumerate}

The output mux (part of framework) collects data for read-out record which are send via MP7 read-out to AMC13.

The IPBus system allows the control of hardware via a ‘virtual bus’, using a standard IP-over-gigabit-Ethernet network connection.
\begin{figure}[h!]
   \centering
    \includegraphics[width=1.0\textwidth]{figures/mGT_payload}
    \caption{\ugt payload}\label{fig:mgt}
 \end{figure}

\subsection{Firmware version}\label{sec:fw_version}

This firmware description is valid for version v1.19.2 of Global Trigger firmware, containing the following module versions:
\begin{itemize}
\item Framework: v1.2.4
\item Global Trigger Logic: v1.17.1
\item Final Decision Logic: v1.3.6
\end{itemize}

\subsection{Directory structure of Global Trigger firmware} \label{dir_struct_gt_fw}

In "../mp7\_ugt\_legacy/firmware" there are directories for synthesis configuration files ("cfg" and "ucf"), for VHDL source files ("hdl"), for memory files build from IPs ("ngc") and simulation files ("sim").\\
All defintions for VHDL code are in "../hdl/packages", VHDL source files representing Global Trigger firmware are in "../hdl/payload" with subdirectories (for gtl, fdl, frame and ipbus).

\subsubsection{Package: lhc\_data\_pkg} \label{section_lhc_data_pkg}

The VHDL record \texttt{lhc\_data\_t} (shown in Listing \ref{lst_lhc_data_t}) is used as a container for all object streams processed by the system. It is declared in the VHDL package \texttt{lhc\_data\_pkg}.
For debugging and simulation purposes a second package (\texttt{lhc\_data\_debug\_util\_pkg}) is created which contains functions to convert the \texttt{lhc\_data\_t} to a hexadecimal string representation and vice versa. The testbench of the design uses this functions to load the contents of the SIM memory from a file.

\lstinputlisting[label=lst_lhc_data_t,language=VHDL,caption=lhc\_data\_t record specification]{interfaces/lhc_data_t.vhd}

\clearpage
