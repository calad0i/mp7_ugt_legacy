\section{Firmware overview}\label{sec:fw}

This description is for version 1.15.3 of Global Trigger firmware, containing the following versions:
\begin{itemize}
\item Frame: 1.2.3
\item Global Trigger Logic: 1.15.2
\item Final Decision Logic: 1.3.6
\end{itemize}

The figure \ref{fig:mgt} shows the architecture of \ugt payload. It consists of framework, IPBus, output mux and the ALGORITHM LOGIC, which it consists of the following modules:
\begin{enumerate}
\item \ugtl
\item \ufdl
\end{enumerate}

The output mux collects data for read-out record which are send via MP7 read-out to AMC13.

The IPBus system allows the control of hardware via a ‘virtual bus’, using a standard IP-over-gigabit-Ethernet network connection (section [\ref{sec:ipbus}]).
\begin{figure}[h!]
   \centering
    \includegraphics[width=1.0\textwidth]{figures/mGT_payload}
    \caption{\ugt payload}\label{fig:mgt}
 \end{figure}

Moreover the \verb|Tx_AMC13| should be instanitate for sending the readout-record to AMC13. This part is outside of framework functionality.

\clearpage

%------------------------------------------------------------------------------
%
%  LHC data Packagee
%
% ------------------------------------------------------------------------------

\subsection{Package: lhc\_data\_pkg} \label{section_lhc_data_pkg}
% \textbf{\textit{Under construction!!!}}

The VHDL record \texttt{lhc\_data\_t} (shown in Listing \ref{lst_lhc_data_t}) is used as a container for all object streams processed by the system. It is declared in the VHDL package \texttt{lhc\_data\_pkg}.
% This package is auto-generated by the python script \texttt{lhc\_data\_pkg\_generator} from the XML specification in Listing \ref{lst_lhc_data_t_xml}. The script generates the record type, converter functions (to/from \texttt{std\_logic\_vector}) and various constants used by other modules in the system.
For debugging and simulation purposes a second package (\texttt{lhc\_data\_debug\_util\_pkg}) is created which contains functions to convert the \texttt{lhc\_data\_t} to a hexadecimal string representation and vice versa. The testbench of the design uses this functions to load the contents of the SIM memory from a file.

\lstinputlisting[label=lst_lhc_data_t,language=VHDL,caption=lhc\_data\_t record specification]{interfaces/lhc_data_t.vhd}

% \lstinputlisting[label=lst_lhc_data_t_xml,language=XML,caption=lhc\_data\_t xml specification]{../../../firmware/gt_amc514/trunk/xml/lhc_data_t.xml}
%

\clearpage
